<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AzDi Animal Pop! - Ads & Rewards</title>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
    
    <style>
        :root { --pink: #ff99cc; --blue: #4facfe; --gold: #ffd700; --font: 'Luckiest Guy', cursive; }
        * { box-sizing: border-box; touch-action: manipulation; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #222; }
        #game-wrapper { width: 100%; max-width: 450px; height: 100%; margin: 0 auto; position: relative; background: #fff; overflow: hidden; }

        /* --- UI STATS --- */
        .top-stats { position: absolute; top: 70px; left: 0; width: 100%; display: flex; justify-content: space-around; z-index: 110; }
        .stat-bubble { background: rgba(0,0,0,0.7); color: white; padding: 5px 15px; border-radius: 20px; font-family: var(--font); font-size: 14px; border: 2px solid white; display: flex; align-items: center; gap: 5px; }

        /* --- MAPA --- */
        #map-screen { position: absolute; inset: 0; overflow-y: auto; background: linear-gradient(#4facfe, #00f2fe, #a8e063, #56ab2f); z-index: 10; }
        #map-topbar { position: sticky; top: 0; height: 60px; background: rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; color: white; font-family: var(--font); z-index: 100; backdrop-filter: blur(5px); }
        .map-nodes { position: relative; width: 100%; height: 7500px; }
        .level-node { position: absolute; width: 75px; height: 75px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: var(--font); color: white; font-size: 24px; background: radial-gradient(circle, #f7a52e, #d47a00); border: 4px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transform: translateX(-50%); cursor: pointer; z-index: 20; }
        .level-node.locked { background: #888; filter: grayscale(1); }

        /* --- JUEGO --- */
        #game-screen { display: none; position: absolute; inset: 0; background: #6ddaff; z-index: 50; flex-direction: column; }
        .game-header { background: var(--pink); padding: 15px; display: flex; justify-content: space-around; color: white; font-family: var(--font); }
        #grid-container { margin: 15px auto; display: grid; grid-template-columns: repeat(8, 1fr); gap: 4px; width: 95%; aspect-ratio: 1/1; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 12px; }
        .cell { background: rgba(255,255,255,0.3); border-radius: 8px; display: flex; justify-content: center; align-items: center; font-size: 32px; cursor: pointer; }
        .cell.selected { transform: scale(1.15); background: white; }

        /* --- BOTONES Y ADS --- */
        .btn { padding: 12px 20px; border-radius: 30px; border: none; font-family: var(--font); font-size: 16px; cursor: pointer; color: white; text-shadow: 1px 1px 2px black; }
        .btn-ads { background: #4caf50; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.3); animation: pulse 2s infinite; }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

        /* --- MODAL DE CARGA (SIMULAR ANUNCIO) --- */
        #ad-overlay { display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 200; color: white; font-family: var(--font); flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="ad-overlay">
        <p>VIENDO ANUNCIO... üì∫</p>
        <div id="ad-timer" style="font-size: 40px;">5</div>
        <p style="font-size: 12px; margin-top: 20px;">(Aqu√≠ ir√≠a el anuncio de Google)</p>
    </div>

    <div class="top-stats" id="ui-stats">
        <div class="stat-bubble">‚ù§Ô∏è <span id="val-lives">5</span></div>
        <div class="stat-bubble">üí∞ <span id="val-coins">0</span></div>
        <button class="btn btn-ads" onclick="showRewardAd()">+ ‚ù§Ô∏è GRATIS</button>
    </div>

    <div id="map-screen">
        <div id="map-topbar"><span>AZDI ANIMAL POP!</span></div>
        <div class="map-nodes" id="nodes-container"></div>
        <button style="position:fixed; bottom:20px; left:20px; background:white; color:#ff2ea6; z-index:1000;" class="btn" onclick="location.reload()">üè† INICIO</button>
    </div>

    <div id="game-screen">
        <div class="game-header">
            <div>LVL: <span id="cur-lvl">1</span></div>
            <div>PUNTOS: <span id="score">0</span></div>
            <div>META: <span id="target">500</span></div>
        </div>
        <div id="grid-container"></div>
        <div class="game-footer" style="margin-top:auto; background:var(--pink); padding:20px; text-align:center;">
            <div style="font-family: var(--font); color: white; font-size: 22px; margin-bottom:10px;">MOVES: <span id="moves">30</span></div>
            <button class="btn" style="background: #ff4d4d;" onclick="closeGame()">RENDIRSE</button>
        </div>
    </div>
</div>

<script>
    const emojis = ['üê∂', 'üê±', 'üêπ', 'üê∞', 'ü¶ä', 'üêª'];
    let unlocked = parseInt(localStorage.getItem('azdi_unlocked')) || 1;
    let coins = parseInt(localStorage.getItem('azdi_coins')) || 0;
    let lives = parseInt(localStorage.getItem('azdi_lives')) || 5;

    let selected = null, score = 0, moves = 30, goal = 500, currentLvl = 1;

    function updateUI() {
        document.getElementById('val-lives').textContent = lives;
        document.getElementById('val-coins').textContent = coins;
        localStorage.setItem('azdi_unlocked', unlocked);
        localStorage.setItem('azdi_coins', coins);
        localStorage.setItem('azdi_lives', lives);
    }

    // --- L√ìGICA DE ANUNCIOS RECOMPENSADOS ---
    function showRewardAd() {
        const overlay = document.getElementById('ad-overlay');
        const timerTxt = document.getElementById('ad-timer');
        overlay.style.display = 'flex';
        let count = 5; // Simulaci√≥n de 5 segundos de video
        
        const interval = setInterval(() => {
            count--;
            timerTxt.textContent = count;
            if (count <= 0) {
                clearInterval(interval);
                overlay.style.display = 'none';
                giveReward();
            }
        }, 1000);
    }

    function giveReward() {
        lives += 3;
        coins += 50;
        alert("¬°Gracias por ver el video! üéâ\nRecibes: +3 Vidas ‚ù§Ô∏è y +50 Monedas üí∞");
        updateUI();
    }

    // --- RESTO DE L√ìGICA DEL JUEGO ---
    function drawMap() {
        updateUI();
        const container = document.getElementById('nodes-container');
        container.innerHTML = '';
        const w = document.getElementById('game-wrapper').clientWidth;

        for (let i = 1; i <= 50; i++) {
            const div = document.createElement('div');
            div.className = `level-node ${i > unlocked ? 'locked' : ''}`;
            div.textContent = i;
            div.style.top = (7200 - (i * 140)) + 'px';
            div.style.left = (w/2 + Math.sin(i * 0.8) * (w * 0.3)) + 'px';
            if (i <= unlocked) div.onclick = () => {
                if (lives > 0) launchLevel(i);
                else alert("¬°Sin vidas! Mira un video para recuperar ‚ù§Ô∏è");
            };
            container.appendChild(div);
        }
        document.getElementById('map-screen').scrollTop = 7200 - (unlocked * 140) - 350;
    }

    function launchLevel(lvl) {
        currentLvl = lvl; score = 0;
        moves = 25 + Math.floor(lvl / 2);
        goal = 500 + (lvl * 200);
        document.getElementById('cur-lvl').textContent = lvl;
        document.getElementById('score').textContent = score;
        document.getElementById('target').textContent = goal;
        document.getElementById('moves').textContent = moves;
        document.getElementById('map-screen').style.display = 'none';
        document.getElementById('ui-stats').style.display = 'none';
        document.getElementById('game-screen').style.display = 'flex';
        initGrid();
    }

    function initGrid() {
        const grid = document.getElementById('grid-container');
        grid.innerHTML = '';
        for (let i = 0; i < 64; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.id = i;
            cell.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            cell.onclick = () => onCellClick(cell);
            grid.appendChild(cell);
        }
    }

    function onCellClick(cell) {
        if (!selected) {
            selected = cell;
            cell.classList.add('selected');
        } else {
            const id1 = parseInt(selected.dataset.id);
            const id2 = parseInt(cell.dataset.id);
            if (isAdjacent(id1, id2)) {
                swap(selected, cell);
                moves--;
                document.getElementById('moves').textContent = moves;
                setTimeout(processMatches, 300);
            }
            selected.classList.remove('selected');
            selected = null;
        }
    }

    function isAdjacent(a, b) {
        const diff = Math.abs(a - b);
        return (diff === 1 && Math.floor(a/8) === Math.floor(b/8)) || diff === 8;
    }

    function swap(a, b) {
        const t = a.textContent;
        a.textContent = b.textContent;
        b.textContent = t;
    }

    function processMatches() {
        const cells = document.querySelectorAll('.cell');
        let matched = new Set();
        for (let i = 0; i < 64; i++) {
            if (i % 8 < 6 && cells[i].textContent && cells[i].textContent === cells[i+1].textContent && cells[i].textContent === cells[i+2].textContent) {
                matched.add(i); matched.add(i+1); matched.add(i+2);
            }
            if (i < 48 && cells[i].textContent && cells[i].textContent === cells[i+8].textContent && cells[i].textContent === cells[i+16].textContent) {
                matched.add(i); matched.add(i+8); matched.add(i+16);
            }
        }

        if (matched.size > 0) {
            score += matched.size * 20;
            document.getElementById('score').textContent = score;
            matched.forEach(i => cells[i].textContent = '');
            setTimeout(drop, 300);
        } else {
            if (score >= goal) {
                coins += 20;
                alert("¬°Nivel superado! +20 monedas üí∞");
                if (currentLvl === unlocked) unlocked++;
                closeGame();
            } else if (moves <= 0) {
                lives--;
                alert("¬°Derrota! Pierdes 1 vida ‚ù§Ô∏è");
                closeGame();
            }
        }
    }

    function drop() {
        const cells = document.querySelectorAll('.cell');
        for (let c = 0; c < 8; c++) {
            for (let r = 7; r >= 0; r--) {
                const i = r * 8 + c;
                if (cells[i].textContent === '') {
                    let top = r - 1;
                    while (top >= 0 && cells[top * 8 + c].textContent === '') top--;
                    if (top >= 0) {
                        cells[i].textContent = cells[top * 8 + c].textContent;
                        cells[top * 8 + c].textContent = '';
                    } else {
                        cells[i].textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    }
                }
            }
        }
        setTimeout(processMatches, 300);
    }

    function closeGame() {
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('ui-stats').style.display = 'flex';
        document.getElementById('map-screen').style.display = 'block';
        drawMap();
    }

    window.onload = drawMap;
</script>
</body>
</html>
