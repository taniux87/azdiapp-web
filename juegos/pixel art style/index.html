<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AzDi Pixel Studio Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
    <style>
        :root { --pink: #ff4fac; --blue: #4facfe; --dark: #121212; --font: 'Luckiest Guy', cursive; }
        body { margin: 0; background: var(--dark); font-family: var(--font); color: white; overflow: hidden; touch-action: none; }
        
        /* PANTALLAS */
        .screen { position: fixed; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; background: var(--dark); z-index: 100; padding: 20px; }
        .screen.active { display: flex; }

        /* BIBLIOTECA */
        .grid-menu { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; max-width: 400px; }
        .card { background: #252525; padding: 15px; border-radius: 20px; border: 3px solid #333; cursor: pointer; transition: 0.2s; }
        .card:active { transform: scale(0.95); border-color: var(--pink); }
        .card-img { font-size: 40px; margin-bottom: 10px; }

        /* JUEGO */
        #game-ui { display: none; height: 100vh; flex-direction: column; }
        #top-bar { height: 70px; display: flex; justify-content: space-around; align-items: center; background: #1a1a1a; border-bottom: 2px solid var(--pink); }
        
        #canvas-wrap { flex: 1; display: flex; align-items: center; justify-content: center; overflow: auto; background: #000; padding: 20px; }
        #grid { display: grid; gap: 1px; background: #333; border: 2px solid #555; }
        .px { width: 30px; height: 30px; background: #fff; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #ccc; }

        /* HERRAMIENTAS Y COLORES */
        #controls { background: #1a1a1a; padding: 15px; border-top: 2px solid #333; }
        .palette-row { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .palette-row::-webkit-scrollbar { display: none; }
        
        .color-dot { width: 45px; height: 45px; border-radius: 50%; border: 3px solid #fff; flex-shrink: 0; display: flex; align-items: center; justify-content: center; color: rgba(0,0,0,0.4); font-size: 18px; }
        .color-dot.active { transform: scale(1.2); border-color: var(--pink); box-shadow: 0 0 15px var(--pink); }

        .tool-box { display: flex; gap: 20px; justify-content: center; margin-bottom: 10px; }
        .tool { background: #333; border: 2px solid #555; padding: 10px 20px; border-radius: 12px; color: white; font-family: var(--font); font-size: 14px; }
        .tool.active { background: var(--blue); border-color: #fff; }

        .btn { background: var(--pink); color: white; border: none; padding: 15px 35px; border-radius: 50px; font-family: var(--font); font-size: 20px; box-shadow: 0 5px 0 #b02e75; }
        .btn:active { transform: translateY(3px); box-shadow: none; }
    </style>
</head>
<body>

<div id="scr-main" class="screen active">
    <h1 style="color:var(--pink); font-size: 40px; margin-bottom: 40px;">AZDI PIXEL STUDIO</h1>
    <button class="btn" onclick="showScreen('scr-lib')">üìö BIBLIOTECA</button>
    <button class="btn" style="background:var(--blue); box-shadow:0 5px 0 #2a80c0; margin-top:20px;" onclick="startFree()">üñåÔ∏è MODO LIBRE</button>
</div>

<div id="scr-lib" class="screen">
    <h2 style="margin-bottom:30px;">ELIGE TU DIBUJO</h2>
    <div class="grid-menu" id="lib-list"></div>
    <button class="btn" style="background:#555; box-shadow:0 5px 0 #333; margin-top:30px;" onclick="showScreen('scr-main')">VOLVER</button>
</div>

<div id="game-ui">
    <div id="top-bar">
        <button onclick="location.reload()" style="background:none; border:none; color:var(--pink); font-family:var(--font); font-size:18px;">‚¨Ö SALIR</button>
        <div id="title">PIXEL ART</div>
        <div id="prog">0%</div>
    </div>
    <div id="canvas-wrap">
        <div id="grid"></div>
    </div>
    <div id="controls">
        <div class="tool-box">
            <button class="tool active" id="t-pen" onclick="setTool('pen')">üñåÔ∏è PINCEL</button>
            <button class="tool" id="t-fill" onclick="setTool('fill')">ü™£ CUBO</button>
        </div>
        <div class="palette-row" id="palette"></div>
    </div>
</div>

<script>
    const COLORS = {
        1: "#FF0000", 2: "#000000", 3: "#FFFF00", 4: "#0000FF", 5: "#FFDBAC", 
        6: "#8B4513", 7: "#00FF00", 8: "#FF00FF", 9: "#00FFFF", 10: "#FFA500",
        11: "#800080", 12: "#FFC0CB", 13: "#FFFFFF", 14: "#444444", 15: "#228B22"
    };

    const DRAWINGS = [
        { n: "MARIO", i: "üçÑ", g: [[0,1,1,1,0],[1,1,1,1,1],[6,5,2,5,5],[6,5,6,5,5],[0,5,5,5,0]] },
        { n: "ESPADA", i: "‚öîÔ∏è", g: [[0,4,0],[4,4,4],[0,4,0],[0,6,0],[6,6,6]] },
        { n: "PATITO", i: "üê§", g: [[3,3,3,0],[3,3,3,10],[3,3,3,3],[0,3,3,0]] },
        { n: "LOVE", i: "‚ù§Ô∏è", g: [[0,1,0,1,0],[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0],[0,0,1,0,0]] }
    ];

    let tool = 'pen';
    let selColor = 1;
    let free = false;

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('game-ui').style.display = 'none';
        if(id !== 'none') document.getElementById(id).classList.add('active');
        if(id === 'scr-lib') renderLib();
    }

    function renderLib() {
        const list = document.getElementById('lib-list');
        list.innerHTML = '';
        DRAWINGS.forEach((d, idx) => {
            const c = document.createElement('div');
            c.className = 'card';
            c.innerHTML = `<div class="card-img">${d.i}</div><div>${d.n}</div>`;
            c.onclick = () => startDrawing(idx);
            list.appendChild(c);
        });
    }

    function startDrawing(idx) {
        free = false;
        const d = DRAWINGS[idx];
        setupGrid(d.g);
        setupPalette(true);
        document.getElementById('title').textContent = d.n;
    }

    function startFree() {
        free = true;
        const empty = Array(12).fill().map(() => Array(12).fill(0));
        setupGrid(empty);
        setupPalette(false);
        document.getElementById('title').textContent = "MODO LIBRE";
    }

    function setupGrid(matrix) {
        showScreen('none');
        document.getElementById('game-ui').style.display = 'flex';
        const g = document.getElementById('grid');
        g.style.gridTemplateColumns = `repeat(${matrix[0].length}, 1fr)`;
        g.innerHTML = '';

        matrix.forEach(row => {
            row.forEach(val => {
                const p = document.createElement('div');
                p.className = 'px';
                p.dataset.target = val;
                p.dataset.curr = "-1";
                if(!free && val !== 0) p.textContent = val;
                p.onclick = () => handlePixel(p);
                g.appendChild(p);
            });
        });
    }

    function setupPalette(withNums) {
        const p = document.getElementById('palette');
        p.innerHTML = '';
        Object.keys(COLORS).forEach(k => {
            const d = document.createElement('div');
            d.className = 'color-dot';
            d.style.background = COLORS[k];
            if(withNums) d.textContent = k;
            d.onclick = () => {
                document.querySelectorAll('.color-dot').forEach(dot => dot.classList.remove('active'));
                d.classList.add('active');
                selColor = k;
            };
            p.appendChild(d);
        });
        document.querySelector('.color-dot').classList.add('active');
    }

    function handlePixel(p) {
        if(tool === 'pen') {
            if(free) p.style.background = COLORS[selColor];
            else if(p.dataset.target == selColor) {
                p.style.background = COLORS[selColor];
                p.dataset.curr = selColor;
                p.textContent = "";
                updateProg();
            }
        } else {
            // Cubo de pintura: en modo libre pinta todo, en guiado no se permite
            if(free) {
                document.querySelectorAll('.px').forEach(px => px.style.background = COLORS[selColor]);
            }
        }
    }

    function setTool(t) {
        tool = t;
        document.querySelectorAll('.tool').forEach(btn => btn.classList.remove('active'));
        document.getElementById('t-'+t).classList.add('active');
    }

    function updateProg() {
        const all = document.querySelectorAll('.px');
        let t = 0, ok = 0;
        all.forEach(p => {
            if(p.dataset.target != "0") {
                t++;
                if(p.dataset.curr == p.dataset.target) ok++;
            }
        });
        const res = Math.floor((ok/t)*100);
        document.getElementById('prog').textContent = res + "%";
        if(res === 100) alert("¬°DIBUJO COMPLETADO! üèÜ");
    }
</script>
</body>
</html>
