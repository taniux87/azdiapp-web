<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AzDi Art Studio Pro | Ultimate Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #ff4fac; --blue: #4facfe; --bg: #0f0f0f; --card: #1e1e1e; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: var(--bg); font-family: 'Roboto', sans-serif; 
            color: white; overflow: hidden; touch-action: none; 
        }

        /* --- NAVEGACI√ìN Y MEN√öS --- */
        #main-menu { 
            position: fixed; inset: 0; z-index: 1000; background: radial-gradient(circle at center, #222, #000);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        
        .logo { font-family: 'Luckiest Guy', cursive; font-size: 3rem; color: var(--accent); margin-bottom: 2rem; text-shadow: 0 0 20px rgba(255,79,172,0.5); }
        
        .menu-grid { 
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 90%; max-width: 500px;
            max-height: 60vh; overflow-y: auto; padding: 10px;
        }

        .draw-card {
            background: var(--card); border: 2px solid #333; border-radius: 20px; padding: 15px;
            text-align: center; cursor: pointer; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .draw-card:active { transform: scale(0.9); border-color: var(--accent); }
        .draw-card i { font-size: 2.5rem; display: block; margin-bottom: 10px; }
        .draw-card span { font-weight: bold; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px; }

        /* --- INTERFAZ DE JUEGO --- */
        #game-interface { display: none; flex-direction: column; height: 100vh; width: 100vw; }
        
        header { 
            height: 70px; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
            border-bottom: 2px solid var(--accent); z-index: 100;
        }

        /* √ÅREA DE TRABAJO (ZOOM & PAN) */
        #workspace { 
            flex: 1; position: relative; overflow: hidden; background: #222;
            display: flex; align-items: center; justify-content: center; cursor: grab;
        }
        #canvas-engine { 
            position: relative; display: grid; background: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.5); transform-origin: center;
            will-change: transform;
        }

        .pixel { 
            width: 30px; height: 30px; border: 0.1px solid rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: bold; color: #ddd; user-select: none;
        }

        /* --- BARRA INFERIOR (PALETA) --- */
        footer { 
            height: 120px; background: #fff; padding: 10px; 
            display: flex; flex-direction: column; gap: 10px; border-top-left-radius: 20px; border-top-right-radius: 20px;
        }
        .palette-scroll { 
            display: flex; gap: 15px; overflow-x: auto; padding: 5px 10px; 
            scrollbar-width: none; align-items: center;
        }
        .palette-scroll::-webkit-scrollbar { display: none; }

        .color-slot { 
            min-width: 55px; height: 55px; border-radius: 50%; border: 4px solid #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; align-items: center;
            justify-content: center; font-size: 1.2rem; color: white; flex-shrink: 0;
            transition: 0.3s; cursor: pointer; font-family: 'Luckiest Guy';
        }
        .color-slot.active { transform: scale(1.2) translateY(-15px); border-color: var(--accent); }
        .color-slot.done { filter: grayscale(1); opacity: 0.5; }

        .tools { display: flex; gap: 20px; justify-content: center; padding-bottom: 5px; }
        .tool-btn { border: none; background: #eee; padding: 5px 15px; border-radius: 10px; font-weight: bold; color: #555; }
        .tool-btn.active { background: var(--blue); color: white; }

        /* --- BOTONES --- */
        .btn-round { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 50px; font-family: 'Luckiest Guy'; cursor: pointer; }
        
        #modal-win { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); 
            z-index: 2000; flex-direction: column; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<div id="main-menu">
    <div class="logo">AZDI STUDIO PRO</div>
    <div class="menu-grid" id="level-list">
        </div>
    <button class="btn-round" style="margin-top: 30px; background: var(--blue);" onclick="initFreeMode()">üé® LIENZO LIBRE</button>
</div>

<div id="game-interface">
    <header>
        <button class="btn-round" onclick="location.reload()">‚¨Ö</button>
        <div id="current-name" style="font-family: 'Luckiest Guy'; letter-spacing: 2px;">DIBUJO</div>
        <div id="progress-text" style="color: var(--accent); font-weight: bold;">0%</div>
    </header>

    <div id="workspace">
        <div id="canvas-engine"></div>
    </div>

    <footer>
        <div class="tools">
            <button id="btn-pen" class="tool-btn active" onclick="setTool('pen')">PINCEL</button>
            <button id="btn-zoom" class="tool-btn" onclick="setTool('zoom')">MOVER / ZOOM</button>
        </div>
        <div class="palette-scroll" id="main-palette"></div>
    </footer>
</div>

<div id="modal-win">
    <h1 style="color: var(--accent); font-size: 3rem;">¬°BRUTAL!</h1>
    <p>Has completado la obra maestra.</p>
    <button class="btn-round" onclick="location.reload()">VOLVER AL INICIO</button>
</div>

<script>
    // --- BASE DE DATOS DE DIBUJOS ---
    const COLORS = {
        1: "#FF3B30", 2: "#000000", 3: "#FFCC00", 4: "#007AFF", 5: "#5856D6",
        6: "#4CD964", 7: "#FF9500", 8: "#FF2D55", 9: "#AF52DE", 10: "#5AC8FA",
        11: "#FFFFFF", 12: "#E5E5EA", 13: "#8E8E93", 14: "#3A3A3C", 15: "#FFCCBC"
    };

    const LIBRARY = [
        { name: "Super Mario", icon: "üçÑ", grid: [
            [0,0,1,1,1,1,1,0,0], [0,1,1,1,1,1,1,1,1,0], [0,6,6,6,15,15,2,15,0], [0,6,15,6,15,15,15,2,0],
            [0,6,15,6,6,15,15,15,0], [0,6,6,15,15,15,15,0,0], [0,0,15,15,15,15,15,0,0], [0,0,1,1,4,1,1,0,0]
        ]},
        { name: "Iron Man", icon: "ü§ñ", grid: [
            [0,1,1,1,1,1,0], [1,1,1,1,1,1,1], [1,10,1,1,1,10,1], [1,1,3,3,3,1,1], [0,1,3,3,3,1,0], [0,0,1,1,1,0,0]
        ]},
        { name: "Batman", icon: "ü¶á", grid: [
            [2,0,0,0,0,0,2], [2,2,2,2,2,2,2], [2,13,2,2,2,13,2], [2,2,2,2,2,2,2], [0,2,2,2,2,2,0], [0,0,2,2,2,0,0]
        ]},
        { name: "Pikachu", icon: "‚ö°", grid: [
            [2,0,0,0,0,0,2], [3,2,0,0,0,2,3], [3,3,3,3,3,3,3], [3,2,3,3,3,2,3], [3,3,3,1,3,3,3], [0,3,3,3,3,3,0]
        ]},
        { name: "Cactus", icon: "üåµ", grid: [
            [0,0,6,6,0,0], [7,0,6,6,0,7], [7,6,6,6,6,7], [0,6,6,6,6,0], [0,0,14,14,0,0]
        ]}
    ];

    // --- VARIABLES DE ESTADO ---
    let currentMode = 'library';
    let currentTool = 'pen';
    let activeColor = 1;
    let zoom = 1;
    let isDragging = false;
    let startX, startY, translateX = 0, translateY = 0;

    // --- INICIALIZACI√ìN ---
    function initMenu() {
        const list = document.getElementById('level-list');
        LIBRARY.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'draw-card';
            card.innerHTML = `<i>${item.icon}</i><span>${item.name}</span>`;
            card.onclick = () => startLibrary(index);
            list.appendChild(card);
        });
    }

    // --- L√ìGICA DE JUEGO ---
    function startLibrary(index) {
        currentMode = 'library';
        const level = LIBRARY[index];
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('game-interface').style.display = 'flex';
        document.getElementById('current-name').textContent = level.name;
        buildCanvas(level.grid);
        buildPalette(level.grid);
    }

    function initFreeMode() {
        currentMode = 'free';
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('game-interface').style.display = 'flex';
        document.getElementById('current-name').textContent = "LIENZO LIBRE";
        const emptyGrid = Array(20).fill().map(() => Array(20).fill(11));
        buildCanvas(emptyGrid);
        buildPalette(null, true);
    }

    function buildCanvas(grid) {
        const engine = document.getElementById('canvas-engine');
        engine.style.gridTemplateColumns = `repeat(${grid[0].length}, 1fr)`;
        engine.innerHTML = '';
        translateX = 0; translateY = 0; zoom = 1;
        updateTransform();

        grid.forEach((row, r) => {
            row.forEach((val, c) => {
                const px = document.createElement('div');
                px.className = 'pixel';
                if(currentMode === 'library' && val !== 0) {
                    px.dataset.target = val;
                    px.textContent = val;
                } else if(currentMode === 'free') {
                    px.style.background = COLORS[val];
                }
                px.onclick = (e) => handlePixel(px);
                engine.appendChild(px);
            });
        });
    }

    function buildPalette(grid, all = false) {
        const pal = document.getElementById('main-palette');
        pal.innerHTML = '';
        let colorsToShow = all ? Object.keys(COLORS) : [...new Set(grid.flat())].filter(v => v !== 0);

        colorsToShow.forEach(num => {
            const slot = document.createElement('div');
            slot.className = `color-slot ${num == activeColor ? 'active' : ''}`;
            slot.style.background = COLORS[num];
            slot.textContent = num;
            slot.onclick = () => {
                document.querySelectorAll('.color-slot').forEach(s => s.classList.remove('active'));
                slot.classList.add('active');
                activeColor = num;
            };
            pal.appendChild(slot);
        });
    }

    function handlePixel(px) {
        if(currentTool !== 'pen') return;

        if(currentMode === 'library') {
            if(px.dataset.target == activeColor) {
                px.style.background = COLORS[activeColor];
                px.dataset.done = "true";
                px.textContent = "";
                px.style.borderColor = "transparent";
                checkWin();
            } else {
                px.style.background = "#ffcccc";
                setTimeout(() => px.style.background = "white", 200);
            }
        } else {
            px.style.background = COLORS[activeColor];
        }
    }

    function checkWin() {
        const total = document.querySelectorAll('.pixel[data-target]').length;
        const done = document.querySelectorAll('.pixel[data-done="true"]').length;
        const p = Math.floor((done/total)*100);
        document.getElementById('progress-text').textContent = p + "%";
        if(p === 100) document.getElementById('modal-win').style.display = 'flex';
    }

    // --- MOTOR DE ZOOM Y PAN ---
    const workspace = document.getElementById('workspace');
    const engine = document.getElementById('canvas-engine');

    workspace.onpointerdown = (e) => {
        if(currentTool === 'zoom') {
            isDragging = true;
            startX = e.clientX - translateX;
            startY = e.clientY - translateY;
            workspace.style.cursor = 'grabbing';
        }
    };

    window.onpointermove = (e) => {
        if(isDragging) {
            translateX = e.clientX - startX;
            translateY = e.clientY - startY;
            updateTransform();
        }
    };

    window.onpointerup = () => {
        isDragging = false;
        workspace.style.cursor = 'grab';
    };

    workspace.onwheel = (e) => {
        e.preventDefault();
        const delta = e.deltaY > 0 ? 0.9 : 1.1;
        zoom *= delta;
        zoom = Math.min(Math.max(0.2, zoom), 5);
        updateTransform();
    };

    function updateTransform() {
        engine.style.transform = `translate(${translateX}px, ${translateY}px) scale(${zoom})`;
    }

    function setTool(t) {
        currentTool = t;
        document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + t).classList.add('active');
    }

    initMenu();
</script>
</body>
</html>
