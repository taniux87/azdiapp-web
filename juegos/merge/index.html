<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AzDi Merge</title>

<style>
body{
margin:0;
overflow:hidden;
background:#05070d;
font-family:Segoe UI,Arial;
color:white;
}

/* estrellas */
canvas#stars{
position:fixed;
top:0;
left:0;
z-index:-1;
}

/* juego */
#game{
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
height:100vh;
}

#score{
color:#00f0ff;
text-shadow:0 0 12px #00f0ff;
margin-bottom:14px;
font-size:26px;
letter-spacing:2px;
}

#board{
background:rgba(20,25,35,.85);
border-radius:28px;
box-shadow:0 0 80px #00f0ff55;
}

/* menu */
#menu,#gameover{
position:fixed;
inset:0;
display:flex;
align-items:center;
justify-content:center;
backdrop-filter:blur(6px);
}

.card{
background:linear-gradient(180deg,#0b0f18,#121826);
padding:34px;
border-radius:22px;
text-align:center;
width:280px;
box-shadow:0 0 50px #00f0ff44;
}

.title{
font-size:28px;
color:#00f0ff;
text-shadow:0 0 15px #00f0ff;
margin-bottom:15px;
}

.desc{opacity:.9;margin-bottom:20px;line-height:1.4}

button{
background:linear-gradient(90deg,#00f0ff,#ff00d4);
border:none;
padding:14px 28px;
border-radius:14px;
color:white;
font-weight:bold;
cursor:pointer;
box-shadow:0 0 25px #00f0ff;
}
button:hover{transform:scale(1.08)}

#gameover{display:none}
</style>
</head>

<body>

<canvas id="stars"></canvas>

<div id="menu">
<div class="card">
<div class="title">AzDi Merge</div>
<div class="desc">
Fusiona criaturas iguales para evolucionarlas.<br><br>
No llenes la caja hasta arriba ðŸ‘€
</div>
<button onclick="startGame()">JUGAR</button>
</div>
</div>

<div id="game" style="display:none">
<div id="score">Puntos: 0</div>
<canvas id="board"></canvas>
</div>

<div id="gameover">
<div class="card">
<div class="title">GAME OVER</div>
<div id="finalScore"></div><br>
<button onclick="restart()">REINTENTAR</button>
</div>
</div>

<script>

/* ===== VARIABLES ===== */
const canvas = document.getElementById("board");
const ctx = canvas.getContext("2d");

let blocks = [];
let score = 0;
let running = false;

const size = 56;
const gravity = 0.45;
const friction = 0.90;

/* criaturas */
const creatures=["ðŸ¥š","ðŸ£","ðŸ¤","ðŸ¥","ðŸ”","ðŸ“","ðŸ¦…","ðŸ²","ðŸ‰","ðŸ‘‘"];
const colors=["#ffe082","#ffd54f","#ffca28","#ffc107","#ff9800","#ff5722","#9c27b0","#673ab7","#2196f3","#00f0ff"];

/* ===== BLOQUE ===== */
class Block{
constructor(x,n){
this.x=x;
this.y=0;
this.vy=0;
this.n=n;
this.restTime=0;
}

update(){

this.vy+=gravity;
this.y+=this.vy;

/* suelo */
if(this.y+size>=canvas.height){
this.y=canvas.height-size;
this.vy*=-0.15;
if(Math.abs(this.vy)<0.3){
this.vy=0;
this.restTime++;
}else this.restTime=0;
}

/* colisiones */
for(const other of blocks){
if(other===this)continue;

if(this.x < other.x+size &&
this.x+size > other.x &&
this.y+size > other.y &&
this.y < other.y &&
this.vy>0){

this.y=other.y-size;
this.vy*=-0.15;

if(Math.abs(this.vy)<0.3){
this.vy=0;
this.restTime++;
}else this.restTime=0;
}
}
}

draw(){
ctx.shadowBlur=25;
ctx.shadowColor=colors[this.n%colors.length];

ctx.fillStyle=colors[this.n%colors.length];
ctx.beginPath();
ctx.roundRect(this.x,this.y,size,size,16);
ctx.fill();

ctx.shadowBlur=0;
ctx.font="28px serif";
ctx.textAlign="center";
ctx.textBaseline="middle";
ctx.fillText(creatures[this.n%creatures.length],this.x+size/2,this.y+size/2);
}
}

/* ===== MERGE REAL ===== */
function mergeBlocks(){

for(let i=0;i<blocks.length;i++){
for(let j=i+1;j<blocks.length;j++){

const a=blocks[i];
const b=blocks[j];

const touching =
a.x < b.x+size &&
a.x+size > b.x &&
a.y < b.y+size &&
a.y+size > b.y;

/* CLAVE: ambos quietos */
if(touching && a.n===b.n && a.restTime>5 && b.restTime>5){

const nx=(a.x+b.x)/2;
const ny=Math.min(a.y,b.y);

blocks.splice(j,1);
blocks.splice(i,1);

const newBlock=new Block(nx,a.n+1);
newBlock.y=ny;

blocks.push(newBlock);

score+=10;
document.getElementById("score").innerText="Puntos: "+score;

return;
}
}
}
}

/* ===== GAME OVER REAL ===== */
function checkGameOver(){
for(const b of blocks){
if(b.y<10 && b.restTime>10){
running=false;
setTimeout(()=>alert("Game Over\nPuntos: "+score),100);
}
}
}

/* ===== LOOP ===== */
function update(){

if(!running)return;

ctx.clearRect(0,0,canvas.width,canvas.height);

for(const b of blocks)b.update();
mergeBlocks();
checkGameOver();
for(const b of blocks)b.draw();

requestAnimationFrame(update);
}

/* ===== SPAWN ===== */
canvas.addEventListener("click",e=>{
if(!running)return;

const rect=canvas.getBoundingClientRect();
const x=e.clientX-rect.left-size/2;
const level=Math.random()<0.8?0:1;

blocks.push(new Block(Math.max(0,Math.min(canvas.width-size,x)),level));
});

/* ===== START ===== */
function start(){
document.getElementById("menu").style.display="none";
document.getElementById("game").style.display="flex";
running=true;
update();
}

</script>

</body>
</html>
