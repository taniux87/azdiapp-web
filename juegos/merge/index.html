<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AzDi Merge | Fix</title>

<style>
body{
margin:0;
overflow:hidden;
background:#05070d;
font-family:Segoe UI,Arial;
color:white;
}

/* estrellas */
#stars{
position:fixed;
inset:0;
z-index:-1;
}

/* juego */
#game{
display:none;
flex-direction:column;
align-items:center;
justify-content:center;
height:100vh;
}

#score{
color:#00f0ff;
text-shadow:0 0 12px #00f0ff;
margin-bottom:14px;
font-size:26px;
letter-spacing:2px;
}

/* tablero */
#board{
background:rgba(20,25,35,.8);
border-radius:28px;
box-shadow:0 0 60px #00f0ff33,inset 0 -80px 120px #00000088;
cursor: crosshair;
}

/* menu */
#menu{
position:fixed;
inset:0;
display:flex;
align-items:center;
justify-content:center;
backdrop-filter:blur(6px);
z-index: 10;
}

.card{
background:linear-gradient(180deg,#0b0f18,#121826);
padding:34px;
border-radius:22px;
text-align:center;
width:280px;
box-shadow:0 0 50px #00f0ff44;
border: 1px solid #00f0ff33;
}

.title{
font-size:28px;
color:#00f0ff;
text-shadow:0 0 15px #00f0ff;
margin-bottom:15px;
}

.desc{opacity:.9;margin-bottom:20px;line-height:1.4}

button{
background:linear-gradient(90deg,#00f0ff,#ff00d4);
border:none;
padding:14px 28px;
border-radius:14px;
color:white;
font-weight:bold;
cursor:pointer;
box-shadow:0 0 25px #00f0ff;
transition: 0.2s;
}
button:hover { transform: scale(1.05); }
</style>
</head>

<body>

<canvas id="stars"></canvas>

<div id="menu">
<div class="card">
<div class="title">AzDi Merge</div>
<div class="desc">
Fusiona criaturas iguales para evolucionarlas.<br>
Si llegan arribaâ€¦ pierdes ðŸ‘€
</div>
<button onclick="startGame()">JUGAR</button>
</div>
</div>

<div id="game">
<div id="score">Puntos: 0</div>
<canvas id="board"></canvas>
</div>

<script>

/* ===== estrellas fondo ===== */
const starCanvas=document.getElementById("stars");
const sctx=starCanvas.getContext("2d");

function resizeStars(){
starCanvas.width=innerWidth;
starCanvas.height=innerHeight;
}
resizeStars();
window.onresize=resizeStars;

let stars=[];
for(let i=0;i<140;i++){
stars.push({x:Math.random()*innerWidth,y:Math.random()*innerHeight,r:Math.random()*2,c:`hsl(${Math.random()*360}deg 100% 70%)`});
}
function drawStars(){
sctx.clearRect(0,0,starCanvas.width,starCanvas.height);
for(const s of stars){
sctx.fillStyle=s.c;
sctx.shadowBlur=10;
sctx.shadowColor=s.c;
sctx.beginPath();
sctx.arc(s.x,s.y,s.r,0,Math.PI*2);
sctx.fill();
}
requestAnimationFrame(drawStars);
}
drawStars();

/* ===== tablero ===== */
const canvas=document.getElementById("board");
const ctx=canvas.getContext("2d");

function resizeBoard(){
canvas.width=Math.min(innerWidth*0.9,400);
canvas.height=Math.min(innerHeight*0.75,600);
}
resizeBoard();

/* ===== juego ===== */
let blocks=[];
let score=0;
let running=false;

const size=50; // Ajustado un poco para mejor manejo
const gravity=.5;

const creatures=["ðŸ¥š","ðŸ£","ðŸ¤","ðŸ¥","ðŸ”","ðŸ“","ðŸ¦…","ðŸ²","ðŸ‰","ðŸ‘‘"];
const colors=["#ffe082","#ffd54f","#ffca28","#ffc107","#ff9800","#ff5722","#9c27b0","#673ab7","#2196f3","#00f0ff"];

class Block{
constructor(x,y,n){
this.x=x;
this.y=y;
this.vy=0;
this.n=n;
this.onGround = false;
}

update(){
this.vy+=gravity;
this.y+=this.vy;

/* suelo */
if(this.y+size>=canvas.height){
this.y=canvas.height-size;
this.vy=0;
this.onGround = true;
} else {
    this.onGround = false;
}

/* colisiones con otros bloques */
for(const o of blocks){
if(o===this)continue;

// DetecciÃ³n de colisiÃ³n simple
if(this.x<o.x+size && this.x+size>o.x && this.y+size>o.y && this.y<o.y){
this.y=o.y-size;
this.vy=0;
this.onGround = true;
}
}
}

draw(){
ctx.shadowBlur=20;
ctx.shadowColor=colors[this.n%colors.length];
ctx.fillStyle=colors[this.n%colors.length];
ctx.beginPath();
ctx.roundRect(this.x,this.y,size,size,12);
ctx.fill();

ctx.shadowBlur=0;
ctx.font="28px serif";
ctx.textAlign="center";
ctx.textBaseline="middle";
ctx.fillText(creatures[this.n%creatures.length],this.x+size/2,this.y+size/2);
}
}

/* merge corregido: DetecciÃ³n por proximidad de centros */
function merge(){
for(let i=0;i<blocks.length;i++){
for(let j=i+1;j<blocks.length;j++){

const a=blocks[i], b=blocks[j];
if(!a || !b) continue;

// Calculamos distancia entre centros
const dx = (a.x + size/2) - (b.x + size/2);
const dy = (a.y + size/2) - (b.y + size/2);
const distance = Math.sqrt(dx*dx + dy*dy);

// Si son iguales y estÃ¡n pegados (distancia menor al tamaÃ±o de la pieza)
if(a.n === b.n && distance < size * 0.95){
const nx = a.x;
const ny = a.y;
const nextLevel = a.n + 1;

// Eliminar ambos
blocks.splice(j, 1);
blocks.splice(i, 1);

// Crear el nuevo nivel en la posiciÃ³n de uno de ellos
if(nextLevel < creatures.length) {
    const nb = new Block(nx, ny, nextLevel);
    blocks.push(nb);
}

score += (nextLevel * 10);
document.getElementById("score").innerText = "Puntos: " + score;
return; // Importante para no romper el loop
}
}
}
}

function checkLose(){
for(const b of blocks){
// Si la pieza estÃ¡ quieta y muy arriba
if(b.onGround && b.y < 40){
running=false;
alert("GAME OVER\nLograste "+score+" puntos");
location.reload();
}
}
}

function loop(){
if(!running)return;

ctx.clearRect(0,0,canvas.width,canvas.height);

// Dibujar lÃ­nea de peligro
ctx.strokeStyle = "rgba(255,0,0,0.2)";
ctx.beginPath();
ctx.moveTo(0, 50); ctx.lineTo(canvas.width, 50);
ctx.stroke();

for(const b of blocks) b.update();
merge();
checkLose();
for(const b of blocks) b.draw();

requestAnimationFrame(loop);
}

canvas.addEventListener("click",e=>{
if(!running)return;

const rect=canvas.getBoundingClientRect();
const x=e.clientX-rect.left-size/2;
const level = 0; // Siempre empezamos por el huevo para que sea como 2048

blocks.push(new Block(Math.max(0,Math.min(canvas.width-size,x)), 0, level));
});

function startGame(){
document.getElementById("menu").style.display="none";
document.getElementById("game").style.display="flex";
running=true;
loop();
}

</script>
</body>
</html>
